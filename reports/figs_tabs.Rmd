<!-- FIGURES -->

```{r flowchart, fig.cap = "Flowchart depicting inclusion criteria and number of patients. Data from the Swedish Hip Arthroplasty Register was used for model derivation and internal validation (left). Data from the National Joint Registry in England and Wales was used for external validation (right)."}
knitr::include_graphics("../graphs/flowchart.png")
```

##### PAGE BREAK

```{r rocs, fig.cap = "Receiver Operation Characteristics (ROC) curves. The area under the ROC curve (AUC) for the reduced model was no different compared to the main model (left panel). The reduced model works almost as good for predictions in the National Joint Registry for England and Wales (right panel)."}
knitr::include_graphics("../graphs/roc.png")
```

##### PAGE BREAK

```{r aucci, fig.cap = "Area Under the Receiver Operation Characteristics Curve (AUC) as a measure of predictive discriminative ability with 95 % bootstrap confidence intervals. The reduced model was no different compared to the main model, neither internally, nor externally (overlapping confidence intervals). AUC above 0.7 was considered good. This was observed for the derived models but not for any other model included for comparison."}

knitr::include_graphics("../graphs/auc_ci.png")
```

##### PAGE BREAK

```{r sep, fig.cap = "Most patients survived more than 90 days after THA, wherefore the blue bars totally dominate the histogram (upper panel; note the scales). A normalized density plot however reveals that patients who died within 90 days were, on average, estimated to have a higher probability to do so (lower panel). There were very few observations with covariate patterns resulting in death probabilities higher than 5% (green line). Estimated probabilities above this limit are therefore subject to extrapolation."}
knitr::include_graphics("../graphs/separation.png")
```

##### PAGE BREAK

```{r calibration, fig.cap = "This figure illustrates calibrartion between observed proportions and predicted probabilities with 95 % confidence intervals. Deviations above the diagonal line means that the model underpredicts the probability of death within 90 days. Such deviation was statistically significant for the external validation for predictions below 1.5%. The higher the predicted probability gets, the more they over-estimate the observed proportions of deaths."}
knitr::include_graphics("../graphs/calibration.png")
```

##### PAGE BREAK





<!-- TABLES -->


```{r tabcategorization}
knitr::kable(
  tab_categorization, 
  caption = "Categorization of co-morbdities based on diagnostic groups according to Charlson and Elixhauser. (CNS = central nervous system.)")

```

##### PAGE BREAK

```{r tab1}
knitr::kable(
  table1, 
  caption = "Characteristics of the study population. Co-morbidities recorded for at least one patient who survived 90 days, and one who did not, were modeled as potential predictors. (CNS = central nervous system.)")
```

##### PAGE BREAK

```{r brlprop}
t <- 
  brlasso_tbl_selected %>% 
  mutate(
    variable = clean_names(variable),
    variable = gsub("= 2", "II", variable),
    variable = gsub("= 3", "III", variable),
  )

knitr::kable(
  t, 
  caption = "Variables selected by the bootstrap ranking procedure, and therefore kept in the main model. Variables chosen at least 33 times out of 100 were kept in the reduced model as well. ASA class II and III were kept in both models, since those are usually distinguished anyway. To simplify the models further would be possible by lumping class I and II together. Variables chosen more frequently are likely more important predictors. This is not necessarily true however since one of several strongly correlated variables might be chosen spuriously. (CNS = central nervous system.)")
```

<!-- Same info in figure so do not use this table -->
```{r auc, warning = FALSE, include = FALSE}
knitr::kable(
  brlasso_tbl_auc %>% 
  filter(
    `Age as` %in% c(NA, "main effect"),
    !endsWith(Model, "cancer") 
  ) %>% 
  select(Model, AUC) %>% 
  rename(`AUC (95 % CI)` = AUC),
  caption = "Area Under the Curve (AUC) as a measure of discriminative ability for the main and reduced models, a model with age and sex, as well as univariable models with ASA class and the Charlson or Elixhauser co-morbidity indices.")
```

##### PAGE BREAK

```{r brlreduced}
brlasso_tbl_coefs %>% 
  select(-math) %>%
  mutate(
    term = gsub("= 2", "II", term),
    term = gsub("= 3", "III", term)
  ) %>% 
knitr::kable(
  caption = 'Estimated coefficients (beta) and odds ratios (OR) with 95% confidence intervals for the reduced model.'
)
```
